asyncapi: 2.4.0
info:
  title: Leden Service
  version: '1.0.0'
  description: "Service voor het registreren, wijzigen en verwijderen van leden."
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0

servers:
  local-kafka:
    url: kafka://localhost:9093
    protocol: kafka

channels:
  event.leden:
    publish:
      bindings:
        kafka:
          groupId: ledenservice
      operationId: ledenActie
      summary: 'Kanaal waarop de berichten m.b.t. de leden worden verstuurd.'
      message:
        oneOf:
          - $ref: '#/components/messages/lidAangemeld'
          - $ref: '#/components/messages/lidGewijzigd'
          - $ref: '#/components/messages/lidVerwijderd'

# Voorbeeld van subscribe actie, de generator voegt automatisch een bericht toe die hij op de
# kafka-bus plaatst in de application.java
    subscribe:
      operationId: lidGewijzigd
      message:
        $ref: '#/components/messages/lidGewijzigdSubscribe'

components:
  messages:
    lidAangemeld:
      messageId: "LidAangemeld"
      name: "LidAangemeld"
      summary: Informeer over het lid dat is aangemeld
      schemaFormat: "application/vnd.apache.avro+json;version=1.9.0"
      payload:
        $ref: 'https://raw.githubusercontent.com/Feature-Branch-BV/ASyncApi-Bibliotheek-Schemas/develop/Lid.avsc'

    lidGewijzigd:
      messageId: "LidGewijzigd"
      summary: Informeer over het gewijzigde lid
      schemaFormat: "application/vnd.apache.avro+json;version=1.9.0"
      payload:
        $ref: 'https://raw.githubusercontent.com/Feature-Branch-BV/ASyncApi-Bibliotheek-Schemas/develop/Lid.avsc'

    lidGewijzigdSubscribe:
      messageId: "LidGewijzigdSubscribe"
      summary: Ontvangen bericht over het gewijzigde lid
      schemaFormat: "application/vnd.apache.avro+json;version=1.9.0"
      payload:
        $ref: 'https://raw.githubusercontent.com/Feature-Branch-BV/ASyncApi-Bibliotheek-Schemas/develop/Lid.avsc'

    lidVerwijderd:
      messageId: "LidVerwijderd"
      summary: Informeer over welk lid verwijderd is
      payload:
        type: object
        $id: LidVerwijderdPayload
        properties:
          id:
            type: string
            format: uuid
            description: 'Unieke identificatie van het lid te verwijderen.'
          verzondenOp:
            type: object
            $ref: './schemas/VerzondenOp.yaml#/schemas/VerzondenOp'
        required:
          - id
          - verzondenOp

# Met de huidige versie van de async-generator moet je het schema's element hebben anders
# snapt hij niet dat hij type-bindings moet toevoegen in de config.
#  schemas:
#    lidAangemeld:
#      type: object
#      $id: 'LidAangemeld'
#      properties:
#        lid:
#          type: string
#          $ref: './schemas/Lid.avsc'
#        verzondenOp:
#          type: object
#          $ref: './VerzondenOp.yaml#/schemas/VerzondenOp'
#      required:
#        - lid
#        - verzondenOp
#    lidGewijzigd:
#      $ref: './schemas/LidGewijzigdPayload.yaml#/schemas/LidGewijzigdPayload'
#    lidVerwijderd:
#      $ref: './schemas/LidVerwijderdPayload.yaml#/schemas/LidVerwijderdPayload'
